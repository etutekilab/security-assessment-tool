<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">
    
    <!-- Load dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Load environment -->
    <script src="env.js"></script>
    
    <!-- Initialize app -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize form first (this doesn't need API access)
                console.log('üìù Initializing assessment form...');
                initializeAssessment();
                
                // Then try to connect to APIs
                if (!window.env) {
                    throw new Error('Environment configuration not loaded');
                }

                // Validate required environment variables
                if (!window.env.OPENAI_API_KEY || !window.env.SUPABASE_URL || !window.env.SUPABASE_ANON_KEY) {
                    throw new Error('Missing required API credentials');
                }

                // Initialize Supabase
                window.supabase = createClient(
                    window.env.SUPABASE_URL,
                    window.env.SUPABASE_ANON_KEY
                );

                // Test API connections
                const { data, error } = await window.supabase.from('assessments').select('count(*)').limit(1);
                if (error) throw error;

                // Enable API features
                document.querySelectorAll('.ai-notes-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.title = 'Get AI suggestions';
                });
                
                document.querySelector('.submit-btn')?.removeAttribute('disabled');
                console.log('‚úÖ API features enabled');
            } catch (error) {
                console.error('‚ùå API Initialization error:', error);
                // Show error banner
                const banner = document.createElement('div');
                banner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #ff4444;
                    color: white;
                    padding: 10px;
                    text-align: center;
                    z-index: 9999;
                `;
                banner.textContent = `‚ö†Ô∏è Some features may be limited. ${error.message}`;
                document.body.appendChild(banner);
            }
        });
    </script>
    
    <!-- Load application scripts -->
    <script src="config.js"></script>
    <script src="script.js"></script>
    
    <title>Cybersecurity Assessment</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <a href="https://www.etutekilab.com" target="_blank" rel="noopener">Etuteki_Lab</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            <h1></h1>
            <p class="intro"></p>
            
            <div id="assessment-form">
                <!-- Progress bar and sections will be dynamically loaded here -->
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 All rights reserved.</p>
            <p class="powered-by">
                Powered by <a href="https://www.etutekilab.com" target="_blank" rel="noopener">Etuteki Lab</a>
            </p>
        </div>
    </footer>
</body>
</html> 